<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PayPal Checkout Demo</title>
    <style>
        body { font-family: sans-serif; padding:20px; background:#fff; color:#111; }
        .box { max-width:420px; margin:0 auto; text-align:center; }
        #amount { font-weight:700; }
        #status { margin-top:12px; color:#444; }
    </style>

    <!-- SDK PayPal (sandbox client-id) -->
    <script src="https://www.paypal.com/sdk/js?client-id=AWLnnAGC_nUJyDODTxpV3_5xS96u_FUEGXEcQdw4CZ7P6OUuojA2B1dVg2yE_ndyJFWe166P1-01wiEA&currency=USD"></script>
</head>
<body>
<div class="box">
    <h2>Checkout</h2>
    <p>Monto: $<span id="amount">0.00</span></p>
    <div id="paypal-button-container"></div>
    <div id="status"></div>
</div>

<script>
    function getParam(name) {
      const p = new URLSearchParams(location.search);
      return p.get(name);
    }
    const amount = getParam('amount') || '0.00';
    document.getElementById('amount').innerText = amount;

    paypal.Buttons({
      style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'paypal' },

      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{ amount: { value: amount } }]
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          console.log("Capture result:", details);
          const orderId = data.orderID; // usar siempre data.orderID
          document.getElementById('status').innerText = 'Pago completado: ' + orderId;
          alert("Pago aprobado con orderId: " + orderId); // debug visual
          if (window.AndroidPay && window.AndroidPay.onPaymentCompleted) {
            window.AndroidPay.onPaymentCompleted(orderId);
          } else {
            window.location = 'paypal://success?orderId=' + encodeURIComponent(orderId);
          }
        });
      },

      onCancel: function (data) {
        document.getElementById('status').innerText = 'Pago cancelado';
        if (window.AndroidPay && window.AndroidPay.onPaymentCancelled) {
          window.AndroidPay.onPaymentCancelled();
        } else {
          window.location = 'paypal://cancel';
        }
      },

      onError: function (err) {
        document.getElementById('status').innerText = 'Error en pago: ' + (err && err.message ? err.message : err);
        console.error('PayPal error', err);
        alert("Error en pago: " + err);
      }
    }).render('#paypal-button-container');
</script>
</body>
</html>
